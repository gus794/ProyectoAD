<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}"></title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 th:text="${title}"></h1>
        <h2>Trabajador: <span th:text="${trabajador.nombre} + ' ' + ${trabajador.apellidos}"></span></h2>
        
        <!-- Menú -->
        <ul class="nav nav-tabs mt-4" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link" th:classappend="${trabajosPendientes != null} ? 'active'" id="pendientes-tab" th:href="@{/views/trabajadores/{idTrabajador}(idTrabajador=${trabajador.idTrabajador})}" role="tab" aria-controls="pendientes" aria-selected="true">Tareas Pendientes</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:classappend="${trabajosFinalizadas != null} ? 'active'" id="finalizadas-tab" th:href="@{/views/trabajadores/{idTrabajador}/finalizadas(idTrabajador=${trabajador.idTrabajador})}" role="tab" aria-controls="finalizadas" aria-selected="false">Tareas Finalizadas</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:classappend="${trabajosPorPrioridad != null} ? 'active'" id="ordenadas-prioridad-tab" th:href="@{/views/trabajadores/{idTrabajador}/prioridad(idTrabajador=${trabajador.idTrabajador})}" role="tab" aria-controls="ordenadas-prioridad" aria-selected="false">Ordenadas por Prioridad</a>
            </li>
        </ul>

        <!-- Formulario para seleccionar prioridad específica -->
        <form th:action="@{/api/trabajos/ByPriority/{idTrabajador}(idTrabajador=${trabajador.idTrabajador})}" method="get" class="form-inline mt-3">
            <div class="form-group">
                <label for="prioridad" class="mr-2">Seleccionar Prioridad:</label>
                <input type="text" class="form-control mr-2" id="prioridad" name="prioridad" placeholder="Ej: Alta">
                <button type="submit" class="btn btn-primary">Filtrar</button>
            </div>
        </form>

        <!-- Contenido del Tab -->
        <div class="tab-content mt-3" id="myTabContent">
            <div th:if="${trabajosPendientes != null}" class="tab-pane fade show active" id="pendientes" role="tabpanel" aria-labelledby="pendientes-tab">
                <table class="table table-striped table-bordered mt-4">
                    <thead class="thead-dark">
                        <tr>
                            <th>Código</th>
                            <th>Categoría</th>
                            <th>Descripción</th>
                            <th>Fecha Inicio</th>
                            <th>Fecha Fin</th>
                            <th>Tiempo</th>
                            <th>Prioridad</th>
                            <th>Cerrar Tarea</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="trabajo : ${trabajosPendientes}">
                            <td th:text="${trabajo.codTrabajo}"></td>
                            <td th:text="${trabajo.categoria}"></td>
                            <td th:text="${trabajo.descripcion}"></td>
                            <td th:text="${#dates.format(trabajo.fechaInicio, 'dd/MM/yyyy')}"></td>
                            <td th:text="${trabajo.fechaFin != null ? #dates.format(trabajo.fechaFin, 'dd/MM/yyyy') : ''}"></td>
                            <td>
                                <form th:action="@{/views/trabajos/{id}/finish(id=${trabajo.codTrabajo})}" method="get" class="form-inline">
                                    <input type="number" class="form-control mr-2" name="tiempo" min="0" step="1" required>
                                    <button type="submit" class="btn btn-success">Cerrar</button>
                                </form>
                            </td>
                            <td th:text="${trabajo.prioridad}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div th:if="${trabajosFinalizadas != null}" class="tab-pane fade show active" id="finalizadas" role="tabpanel" aria-labelledby="finalizadas-tab">
                <table class="table table-striped table-bordered mt-4">
                    <thead class="thead-dark">
                        <tr>
                            <th>Código</th>
                            <th>Categoría</th>
                            <th>Descripción</th>
                            <th>Fecha Inicio</th>
                            <th>Fecha Fin</th>
                            <th>Tiempo</th>
                            <th>Prioridad</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="trabajo : ${trabajosFinalizadas}">
                            <td th:text="${trabajo.codTrabajo}"></td>
                            <td th:text="${trabajo.categoria}"></td>
                            <td th:text="${trabajo.descripcion}"></td>
                            <td th:text="${#dates.format(trabajo.fechaInicio, 'dd/MM/yyyy')}"></td>
                            <td th:text="${#dates.format(trabajo.fechaFin, 'dd/MM/yyyy')}"></td>
                            <td th:text="${trabajo.tiempo}"></td>
                            <td th:text="${trabajo.prioridad}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div th:if="${trabajosPorPrioridad != null}" class="tab-pane fade show active" id="porPrioridad" role="tabpanel" aria-labelledby="porPrioridad-tab">
                <table class="table table-striped table-bordered mt-4">
                    <thead class="thead-dark">
                        <tr>
                            <th>Código</th>
                            <th>Categoría</th>
                            <th>Descripción</th>
                            <th>Fecha Inicio</th>
                            <th>Fecha Fin</th>
                            <th>Tiempo</th>
                            <th>Prioridad</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="trabajo : ${trabajosPorPrioridad}">
                            <td th:text="${trabajo.codTrabajo}"></td>
                            <td th:text="${trabajo.categoria}"></td>
                            <td th:text="${trabajo.descripcion}"></td>
                            <td th:text="${#dates.format(trabajo.fechaInicio, 'dd/MM/yyyy')}"></td>
                            <td th:text="${#dates.format(trabajo.fechaFin, 'dd/MM/yyyy')}"></td>
                            <td th:text="${trabajo.tiempo}"></td>
                            <td th:text="${trabajo.prioridad}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <a class="btn btn-info mt-3" th:href="@{/views}">Volver</a>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
